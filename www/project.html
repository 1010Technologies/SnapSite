<html>
    <head>
        <meta charset="UTF-8">
        <title>Snap! Build Your Own Blocks</title>
        <meta name="description" content="The Snap! social platform">
        <meta name="author" content="Bernat Romagosa">
        <meta name="snap-cloud-domain" location="https://cloud.snap.berkeley.edu">
        <link rel="icon" href="favicon.png">

        <!-- External libs, both stylesheets and JS -->
        <link rel="stylesheet" href="libs/reset.css">
        <link rel="stylesheet" href="libs/pure-min.css">
        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css" integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous">
        <link rel="stylesheet" href="libs/custom-alert.css">
        <script type="text/javascript" src="libs/FileSaver.min.js"></script>

        <link rel="stylesheet" href="style/elements.css">
        <link rel="stylesheet" href="style/classes.css">
        <link rel="stylesheet" href="style/layout.css">
        <script type="text/javascript" src="js/locale.js"></script>
        <script type="text/javascript" src="js/base.js"></script>

        <script type="text/javascript" src="libs/cloud.js"></script>
        <script type="text/javascript">SnapCloud = new Cloud();</script>
        <script type="text/javascript" src="https://rawgit.com/bromagosa/Snap/gh-pages/sha512.js"></script>
    </head>
    <body>
        <script type="text/javascript" src="libs/custom-alert.min.js"></script>
        <script>new customAlert();</script>
        <div id="loading"><i class="fas fa-spinner fa-spin fa-3x" aria-hidden="true"></i></div>
        <div id="top-bar">
            <div class="pure-menu-horizontal pure-menu">
                <ul class="pure-g pure-menu-list">
                    <a class="pure-u-1-12" href="index.html"><img src="img/topbar-logo.png" class="logo clickable"/></a>
                    <span class="pure-u-1-4">
                        <li class="pure-menu-item"><a localizable class="pure-menu-link run" target="_blank">Run Snap<em>!</em></a></li>
                        <li class="pure-menu-item"><a localizable class="pure-menu-link" href="explore.html">Explore</a></li>
                    </span>
                    <i class="pure-u-1-6"></i>
                    <div class="search pure-u-1-6">
                        <form action="search.html">
                            <input type="text" name="term">
                            <i class="fas fa-search"></i>
                        </form>
                    </div>
                    <i class="pure-u-3-24"></i>
                    <li hidden="true" class="join pure-menu-item pure-u-1-12"><a localizable class="pure-menu-link" href="signup.html">Join</a></li>
                    <li hidden="true" class="sign-in pure-menu-item pure-u-1-12"><a localizable class="pure-menu-link" href="login.html">Log In</a></li>
                    <li hidden="true" class="pure-menu-item pure-u-1-6 pure-menu-has-children pure-menu-allow-hover user-menu">
                        <a href="#" id="menuLink1" class="pure-menu-link visitor"></a>
                        <ul class="pure-menu-children">
                            <li class="pure-menu-item"><a localizable class="pure-menu-link my-projects" href="myprojects.html">My Projects</a></li>
                            <li class="pure-menu-item"><a localizable class="pure-menu-link my-public-projects" href="">My Public Page</a></li>
                            <li class="pure-menu-item"><a localizable class="pure-menu-link my-profile" href="profile.html">My Profile</a></li>
                            <li hidden="true" class="pure-menu-item admin"><a localizable class="pure-menu-link" href="admin.html">Administration</a></li>
                            <hr>
                            <li class="pure-menu-item"><a localizable class="pure-menu-link" href="#" onclick="SnapCloud.logout(function () { sessionStorage.clear(); location.href = 'index.html'; });">Log Out</a></li>
                        </ul>
                    </li>
                    <li class="pure-menu-item pure-u-1-24 pure-menu-has-children pure-menu-allow-hover settings">
                        <a class="pure-menu-link" href="#"><i class="fas fa-bars"></i></a>
                        <ul class="pure-menu-children pure-u-3-24">
                            <li class="pure-menu-item pure-menu-has-children pure-menu-allow-hover">
                                <a localizable class="pure-menu-link" href="">Language</a>
                                <ul class="pure-menu-children languages">
                                    <a class="pure-menu-link" href="" onclick="localizer.setLanguage('es');">Castellano</a>
                                    <a class="pure-menu-link" href="" onclick="localizer.setLanguage('ca');">Catal√†</a>
                                    <a class="pure-menu-link" href="" onclick="localizer.setLanguage('de');">Deutsch</a>
                                    <a class="pure-menu-link" href="" onclick="localizer.setLanguage('en');">English</a>
                                </ul>
                            </li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
        <div id="wrapper">
<script src="js/project.js"></script>
<script src="js/inplace.js"></script>
<link rel="stylesheet" href="style/project.css">

<div hidden class="project big">
    <div class="title">
        <h1></h1>
        <span class="remixed-from"></span>
    </div>
    <div class="viewer pure-g">
        <!-- Project viewer -->
        <div class="embed pure-u-1-2">
            <div class="controlbar">
                <i class="present-button fas fa-expand clickable" onclick="toggleFullScreen();"></i>
                <i class="start-button fas fa-flag clickable" onclick="runProject();"></i>
                <i class="stop-button fas fa-stop clickable" onclick="stopProject();"></i>
            </div>
            <iframe height="406" src=""> </iframe>
        </div>

        <i class="pure-u-1-24"></i>
        <div class="details pure-u-11-24">

            <!-- Notes -->
            <pre class="notes"> </pre>

            <!-- Project Action Buttons -->
            <div class="buttons">
                <a localizable class="pure-button open" target="_blank">Edit</a>
                <a localizable class="pure-button download" target="_blank">Download</a>
                <a localizable class="pure-button share" target="_blank">Share</a>
                <a localizable class="pure-button unshare" target="_blank">Unshare</a>
                <a localizable class="pure-button publish" target="_blank">Publish</a>
                <a localizable class="pure-button unpublish" target="_blank">Unpublish</a>
                <a localizable class="pure-button pure-button-warning delete" target="_blank">Delete</a>
            </div>
        </div>

        <!-- Dates and project meta -->
        <span class="dates pure-u-1-2">
            <span localizable class="created">Created on </span>.
            <span localizable class="updated">Last updated on </span><span localizable class="shared">, shared on </span><span localizable class="published"></span>.
            <span localizable class="is-public">This project is </span><span localizable class="is-published"></span>.
        </span>
    </div>

    <!-- Collection of remixes -->
    <div class="remixes">
<h2 localizable>Remixes</h2>
<script src="js/project.js"></script>
<link rel="stylesheet" href="style/project.css">
<nav class="remixes paginator">
    <a href="#" onclick="remixes_toPage(1);"><i class="fas fa-fast-backward"></i></a>
    <a href="#" onclick="remixes_toPage(remixes_page - 5 > 0 ? remixes_page - 5 : 1);"><i class="fas fa-backward"></i></a>
    <a href="#" onclick="remixes_toPage(remixes_page - 1 > 0 ? remixes_page - 1 : remixes_page);"><i class="fas fa-play fa-rotate-180"></i></a>
    <span class="page"></span> / <span class="total-pages"></span>
    <a href="#" onclick="remixes_toPage(remixes_page + 1 < remixes_totalPages ? remixes_page + 1 : remixes_totalPages);"><i class="fas fa-play"></i></a>
    <a href="#" onclick="remixes_toPage(remixes_page + 5 < remixes_totalPages ? remixes_page + 5 : remixes_totalPages);"><i class="fas fa-forward"></i></a>
    <a href="#" onclick="remixes_toPage(remixes_totalPages);"><i class="fas fa-fast-forward"></i></a>
</nav>
<div class="remixes projects pure-g"></div>
<script>
    var remixes_projectsDiv = document.querySelector('.remixes.projects'),
        remixes_pageSpan = document.querySelector('.remixes.paginator .page'),
        remixes_totalPagesSpan = document.querySelector('.remixes.paginator .total-pages'),
        remixes_page = 1,
        remixes_totalPages = 1,
        remixes_pageSize = 5 || 15;

    remixes_toPage(1);

    function remixes_toPage (pageNumber) {
        remixes_projectsDiv.innerHTML = '';
        beganLoading('.remixes.projects');
        SnapCloud.getRemixes(
            pageUser(),
            pageNumber,
            remixes_pageSize,
            pageProject(), // used for search terms, collection names, etc
            function (response) {
                setTitle("Snap! Build Your Own Blocks");

                remixes_totalPages = response.pages;
                if (remixes_totalPages == 1) {
                    document.querySelector('.remixes.paginator').remove();
                } else {
                    remixes_totalPagesSpan.textContent = remixes_totalPages;
                }

                if (response.projects[0]) {
                    response.projects.forEach(function (project) {
                        remixes_projectsDiv.append(
                                newProjectDiv(
                                project,
                                {
                                    size: 'small',
                                    gridSize: 5,
                                    extraFields: {
                                        author: 'username'
                                    }
                                }));
                    });
                } else {
                    // collection is empty, so let's remove the carousel altogether
                    document.querySelector('.remixes').remove();
                }
                doneLoading('.remixes.projects');
            },
            function (error) {
                genericError(error);
            },
            true // withThumbnail
        );
        remixes_page = pageNumber;
        remixes_pageSpan.textContent = pageNumber;
    };
</script>
    </div>
</div>

<script>
    beganLoading('#wrapper');
    SnapCloud.getProjectMetadata(
        pageProject(),
        pageUser(),
        function (project) {
            setTitle(pageProject() + localizer.localize(' by ') + pageUser() + ' - Snap! Build Your Own Blocks');

            // Fill up all fields
            var title = document.querySelector('.title h1');

            title.innerHTML = project.projectname;
            if (ownsProject(project)) {
                new InPlaceEditor(
                    title,
                    function () {
                        SnapCloud.updateProjectName(
                            pageProject(),
                            title.textContent,
                            function () { location.href = 'project.html?user=' + pageUser() + '&project=' + title.textContent; },
                            genericError
                        );
                    })
            }
            document.querySelector('.title').append(authorSpan(project.username));
            document.querySelector('.project iframe').src = projectURL(project.username, project.projectname) + '&embedMode&noExitWarning&noRun';
            document.querySelector('.notes').innerHTML = project.notes || '<small>' + localizer.localize('This project has no notes') + '</small>';
            document.querySelector('.created').append(formatDate(project.created));
            document.querySelector('.updated').append(formatDate(project.lastupdated));

            if (project.ispublic) {
                document.querySelector('.shared').append(formatDate(project.lastshared));
                document.querySelector('.is-published').innerHTML += (project.ispublished ? ' and listed' : ' but unlisted');
                if (project.ispublished) {
                    document.querySelector('.published').innerHTML = localizer.localize(', published on ') + formatDate(project.firstpublished);
                }
                document.querySelector('.is-public').innerHTML += ('public');
            } else {
                document.querySelector('.shared').hidden = true;
                document.querySelector('.is-public').append('private');
            }

            if (project.remixedfrom) {
                var div = document.querySelector('.remixed-from');
                div.innerHTML = localizer.localize('(remixed from ');
                if (project.remixedfrom.projectname) {
                    div.append(projectSpan(project.remixedfrom.username, project.remixedfrom.projectname));
                    div.append(authorSpan(project.remixedfrom.username));
                } else {
                    div.append('a project that no longer exists');
                }
                div.innerHTML += ')';
            }

            // Set up all buttons
            document.querySelector('.buttons .share').hidden = project.ispublic || !ownsProject(project);
            document.querySelector('.buttons .unshare').hidden = !project.ispublic || !ownsProject(project);
            document.querySelector('.buttons .publish').hidden = (!project.ispublic || project.ispublished) || !ownsProject(project);
            document.querySelector('.buttons .unpublish').hidden = (!project.ispublic || !project.ispublished) || !ownsProject(project);
            document.querySelector('.buttons .delete').hidden = !ownsProject(project);

            document.querySelector('.buttons .open').href = projectURL(project.username, project.projectname) + '&editMode&noRun';
            document.querySelector('.buttons .download').onclick = function () { downloadProject(project); };
            document.querySelector('.buttons .share').onclick = function () { confirmShareProject(project); };
            document.querySelector('.buttons .unshare').onclick = function () { confirmUnshareProject(project); };
            document.querySelector('.buttons .publish').onclick = function () { confirmPublish(project); };
            document.querySelector('.buttons .unpublish').onclick = function () { confirmUnpublish(project); }
            document.querySelector('.buttons .delete').onclick = function () { confirmDelete(project); }

            doneLoading('#wrapper');
            document.querySelector('.project').hidden = false;

            // In-place notes editor
            var notes = document.querySelector('.notes');
            if (ownsProject(project)) {
                new InPlaceEditor(
                    notes,
                    function () {
                        SnapCloud.updateNotes(
                            pageProject(),
                            notes.textContent,
                            function () {
                                if (notes.textContent == '') {
                                    notes.innerHTML = '<small>' + localizer.localize('This project has no notes') + '</small>';
                                }
                            }, 
                            genericError
                        );
                    }
                );
            } 
        },
        genericError
    );

</script>
        </div>
        <div id="footer">
            <div class="links pure-g">
                <div class="pure-u-1-5">
                    <p><h4 localizable>About</h4></p>
                    <p><a localizable href="about.html">About Snap<em>!</em></a></p>
                    <p><a localizable href="blog.html">Blog</a></p>
                    <p><a localizable href="credits.html">Credits</a></p>
                    <p><a localizable href="requirements.html">Technical Requirements</a></p>
                    <p><a localizable href="partners.html">Partners</a></p>
                    <p><a localizable target="_blank" href="https://github.com/jmoenig/Snap--Build-Your-Own-Blocks">Source Code</a></p>
                </div>
                <div class="pure-u-1-5">
                    <p><h4 localizable>Learning</h4></p>
                    <p><a localizable href="examples.html">Examples</a></p>
                    <p><a localizable href="manual.html">Reference Manual</a></p>
                    <p><a localizable href="materials.html">Materials</a></p>
                    <p><a localizable href="bjc.html">BJC</a></p>
                </div>
                <div class="pure-u-1-5">
                    <p><h4 localizable>Tools</h4></p>
                    <p><a localizable href="extensions.html">Extensions</a></p>
                    <p><a target="_blank" href="http://snapp.citilab.eu">Snapp<em>!</em></a></p>
                    <p><a target="_blank" href="https://djsrv.github.io/Snapin8r2/">Snapin8r2</a></p>
                </div>
                <div class="pure-u-1-5">
                    <p><h4 localizable>Support</h4></p>
                    <p><a localizable target="_blank" href="https://forum.snap.berkeley.edu/">Forum</a></p>
                    <p><a localizable href="contact.html">Contact Us</a></p>
                    <p><a localizable href="mirrors.html">Mirrors</a></p>
                </div>
                <div class="pure-u-1-5">
                    <p><h4 localizable>Legal</h4></p>
                    <p><a localizable href="dmca.html">DMCA</a></p>
                    <p><a localizable href="privacy.html">Privacy</a></p>
                    <p><a localizable href="tos.html">Terms of Service</a></p>
                </div>
            </div>
        </div>
    </body>
    <script>
    SnapCloud.genericError = genericError;
    document.querySelector('#top-bar .run').href = snapURL;
    if (!sessionStorage.username) {
        SnapCloud.initSession(
            function (username, isadmin) {
                sessionStorage.username = username;
                sessionStorage.isadmin = isadmin;
                initForUsername(username);
            }
        );
    } else {
        initForUsername(sessionStorage.username);
    }

    function initForUsername (username) {
        if (username) {
            SnapCloud.username = username;
            document.querySelector('li.join').hidden = true;
            document.querySelector('li.sign-in').hidden = true;
            document.querySelector('li.user-menu').hidden = false;
            document.querySelector('a.my-public-projects').href = 'user.html?user=' + username;
            if (sessionStorage.isadmin == 'true') {
                document.querySelector('.admin').hidden = false;
            }
            fillVisitorFields();
        } else {
            document.querySelector('li.join').hidden = false;
            document.querySelector('li.sign-in').hidden = false;
            document.querySelector('li.user-menu').hidden = true;
        }
        fillUsernameFields();
        fillVisitorFields();
        doneLoading();
    }
    </script>
</html>
