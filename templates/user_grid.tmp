<h2 localizable>${header}</h2>
<link rel="stylesheet" href="style/usergrid.css">
@include=paginator
<div class="${widgetName} users pure-g"></div>
<script>
    var ${widgetName}_usersDiv =
            document.querySelector('.${widgetName}.users'),
        ${widgetName}_pageSpan =
            document.querySelector('.${widgetName}.paginator .page'),
        ${widgetName}_totalPagesSpan =
            document.querySelector('.${widgetName}.paginator .total-pages'),
        ${widgetName}_page = 1,
        ${widgetName}_totalPages = 1,
        ${widgetName}_pageSize = ${pageSize} || 15;

    ${widgetName}_toPage(1);

    function ${widgetName}_toPage (pageNumber) {
        ${widgetName}_usersDiv.innerHTML = '';
        beganLoading('.${widgetName}.users');
        SnapCloud.withCredentialsRequest(
            'GET',
            '/users?matchtext=' + encodeURIComponent(${extraParam}) +
                '&pagesize=' + ${widgetName}_pageSize + '&page=' + pageNumber,
            function (response) {
                ${widgetName}_totalPages = response.pages;
                if (${widgetName}_totalPages == 1) {
                    document.querySelector('.${widgetName}.paginator').remove();
                } else {
                    ${widgetName}_totalPagesSpan.textContent =
                        ${widgetName}_totalPages;
                }

                if (response.users[0]) {
                    response.users.forEach(function (user) {
                        var div = document.createElement('div');
                        div.classList.add('pure-u-1-3');
                        div.classList.add('user');
                        div.appendChild(userAnchor(user.username));
                        ${widgetName}_usersDiv.append(div);
                    });
                } else {
                    // collection is empty, so let's remove the carousel altogether
                    document.querySelector('.${widgetName}').remove();
                }
                doneLoading('.${widgetName}.users');
            },
            genericError,
            'Could not fetch user list'
        );
        ${widgetName}_page = pageNumber;
        ${widgetName}_pageSpan.textContent = pageNumber;
    };
</script>
