<script src="js/project.js"></script>
<script src="js/dialog.js"></script>
<link rel="stylesheet" href="style/project.css">
<h1 localizable>My Collections</h1>
@param actionPage=my_collections
@include=search_bar
<div class="buttons">
    <a class="pure-button new-collection">New Collection</a>
</div>
<script>
    ${className}_loadPage =
        function (term, pageSize, pageNumber, onSuccess) {
            SnapCloud.getUserCollections(
                null, // username is implicit
                pageNumber,
                pageSize,
                term,
                onSuccess,
                genericError,
                'Could not fetch collection list'
            );
        };
        
    ${className}_onLoadPage =
        function (response, targetElement) {
            response.collections.forEach(function (collection) {
                targetElement.append(
                    newCollectionDiv(
                        collection, 
                        { 
                            size: 'small', 
                            gridSize: 5, 
                            extraFields: {
                                isPublic: 'shared',
                                isPublished: 'published'
                            }
                        }
                    )
                );
            }); 
        };

    ${className}_initSearch();

    document.querySelector('.new-collection').onclick = function () {
        prompt(
            localizer.localize('Collection name?'),
            function (collectionName) {
                SnapCloud.newCollection(
                    collectionName,
                    function (collection) {
                        location.replace(
                            collectionURL(SnapCloud.username, collectionName)
                        );
                    },
                    genericError
                ); 
            },
            nop
        );
    };
</script>
