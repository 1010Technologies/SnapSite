<script src="js/project.js"></script>
<link rel="stylesheet" href="style/project.css">

<div hidden class="project big">
    <div class="pure-g">
        <div class="title pure-u-1-2">
            <h1></h1>
        </div>
    </div>
    <div class="pure-g">
        <iframe class="pure-u-1-2" height="406" src=""> </iframe>

        <i class="pure-u-1-24"></i>
        <div class="details pure-u-11-24">
            <pre class="notes"></pre>
            <div class="buttons">
                <a localizable class="pure-button open" target="_blank">Edit</a>
                <a localizable class="pure-button download" target="_blank">Download</a>
                <a localizable class="pure-button share" target="_blank">Share</a>
                <a localizable class="pure-button unshare" target="_blank">Unshare</a>
                <a localizable class="pure-button publish" target="_blank">Publish</a>
                <a localizable class="pure-button unpublish" target="_blank">Unpublish</a>
            </div>
        </div>
        <span class="dates pure-u-1-2">
            <span localizable class="created">Created on </span>.
            <span localizable class="updated">Last updated on </span><span localizable class="shared">, shared on </span>.
            <span localizable class="is-public">This project is </span><span localizable class="is-published"></span>.
        </span>
    </div>
</div>

<script>
    beganLoading('#wrapper');
    SnapCloud.getProjectMetadata(
        pageProject(),
        pageUser(),
        function (project) {
            setTitle(pageProject() + localizer.localize(' by ') + pageUser() + ' - Snap! Build Your Own Blocks');
            document.querySelector('.title h1').innerHTML = project.projectname;
            document.querySelector('.title').append(authorSpan(project.username));
            document.querySelector('.project iframe').src = projectURL(project.username, project.projectname) + '&embedMode&noExitWarning&noRun';
            document.querySelector('.notes').innerHTML = project.notes || '<small>' + localizer.localize('This project has no notes') + '</small>';
            document.querySelector('.created').append(formatDate(project.created));
            document.querySelector('.updated').append(formatDate(project.lastupdated));

            if (project.ispublic) {
                document.querySelector('.shared').append(formatDate(project.lastshared));
                document.querySelector('.is-published').innerHTML += (project.ispublished ? ' and listed' : ' but unlisted');
                document.querySelector('.is-public').innerHTML += ('public');
            } else {
                document.querySelector('.shared').hidden = true;
                document.querySelector('.is-public').append('private');
            }

            document.querySelector('.buttons .share').hidden = project.ispublic;
            document.querySelector('.buttons .unshare').hidden = !project.ispublic;
            document.querySelector('.buttons .publish').hidden = !project.ispublic || project.ispublished;
            document.querySelector('.buttons .unpublish').hidden = !project.ispublic || !project.ispublished;

            document.querySelector('.buttons .open').href = projectURL(project.username, project.projectname) + '&editMode&noRun';
            document.querySelector('.buttons .download').onclick = function () { downloadProject(project); };
            document.querySelector('.buttons .share').onclick = function () {
                confirm(
                    localizer.localize('Are you sure you want to share this project?'),
                    function (ok) {
                        if (ok) {
                            SnapCloud.shareProject(
                                project.projectname,
                                function () {
                                    alert(
                                        localizer.localize('You can now access this project at:') +
                                        '<br><a href="' + projectURL(project.username, project.projectname) + '">' +
                                        projectURL(project.username, project.projectname) + '</a>',
                                        { title: localizer.localize('Project shared') },
                                        function () { location.reload() }
                                    );
                                },
                                function () { genericError('Could not share project'); }
                            );
                        }
                    },
                    confirmTitle('Share project')
                );
            };
            document.querySelector('.buttons .unshare').onclick = function () {
                confirm(
                    localizer.localize('Are you sure you want to stop sharing this project?'),
                    function (ok) {
                        if (ok) {
                            SnapCloud.unshareProject(
                                project.projectname,
                                function () {
                                    alert(
                                        localizer.localize('This project is now private.'),
                                        { title: localizer.localize('Project unshared') },
                                        function () { location.reload() }
                                    );
                                },
                                function () { genericError('Could not unshare project'); }
                            );
                        }
                    },
                    confirmTitle('Unshare project')
                );
            };
            document.querySelector('.buttons .publish').onclick = function () {
                confirm(
                    localizer.localize('Are you sure you want to publish this project<br>' + 
                        'and make it visible in the Snap<em>!</em> website?'),
                    function (ok) {
                        if (ok) {
                            SnapCloud.publishProject(
                                project.projectname,
                                function () {
                                    alert(
                                        localizer.localize('This project is now listed in the Snap<em>!</em> site.'),
                                        { title: localizer.localize('Project published') },
                                        function () { location.reload() }
                                    );
                                },
                                function () { genericError('Could not publish project'); }
                            );
                        }
                    },
                    confirmTitle('Publish project')
                );
            };
            document.querySelector('.buttons .unpublish').onclick = function () {
                confirm(
                    localizer.localize('Are you sure you want to unpublish this project<br>' + 
                        'and hide it from the Snap<em>!</em> website?'),
                    function (ok) {
                        if (ok) {
                            SnapCloud.unpublishProject(
                                project.projectname,
                                function () {
                                    alert(
                                        localizer.localize('This project is not listed in the Snap<em>!</em> site anymore.'),
                                        { title: localizer.localize('Project unpublished') },
                                        function () { location.reload() }
                                    );
                                },
                                function () { genericError('Could not unpublish project'); }
                            );
                        }
                    },
                    confirmTitle('Unpublish project')
                );
            };

            doneLoading('#wrapper');
            document.querySelector('.project').hidden = false;
        },
        function (error) {
            genericError(error);
            throw(error);
        }
    );
</script>
