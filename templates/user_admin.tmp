<script>
    SnapCloud.getCurrentUser(function (user) {
        // Only admins and moderators can access this page
        if (['admin', 'moderator'].indexOf(user.role) == -1) {
            location.href = 'index';
        }
    });
</script>
<script src="js/dialog.js"></script>
<script src="js/admin.js"></script>
<link rel="stylesheet" href="style/admin.css">
<h1 localizable>User Administration</h1>
<div class="bar">
@param actionPage=user_admin
@include=search_bar
@include=paginator
</div>
<div class="${className} list pure-g"></div>
<script>
    ${className}_loadPage =
        function (term, pageSize, pageNumber, onSuccess) {
            SnapCloud.withCredentialsRequest(
                'GET',
                '/users?' +
                    (term ?
                        'matchtext=' + encodeURIComponent(term) + '&'
                        : '' ) +
                    'pagesize=' + pageSize + '&page=' + pageNumber,
                onSuccess,
                genericError,
                'Could not fetch user list'
            ); 
        };

    ${className}_onLoadPage =
        function (response, targetElement) {
            response.users.forEach(function (user) {
                targetElement.appendChild(userDiv(user));
            });
        };

    ${className}_initSearch();
</script>
