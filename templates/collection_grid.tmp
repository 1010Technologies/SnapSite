<h2 class="${widgetName} header" localizable>$header</h2>
<script src="js/project.js"></script>
<link rel="stylesheet" href="style/project.css">
@include=paginator
<div class="${widgetName} items pure-g"></div>
<script>
    var ${widgetName}_collectionsDiv =
            document.querySelector('.${widgetName}.items'),
        ${widgetName}_pageSpan =
            document.querySelector('.${widgetName}.paginator .page'),
        ${widgetName}_totalPagesSpan =
            document.querySelector('.${widgetName}.paginator .total-pages'),
        ${widgetName}_page = 1,
        ${widgetName}_totalPages = 1,
        // hack so this works with empty gridSize or pageSize. [][0] || 5 â†’ 5
        ${widgetName}_gridSize = [${gridSize}][0] || 5,
        ${widgetName}_pageSize = [${pageSize}][0] || 15;

    ${widgetName}_toPage(1);

    if (!['$header'][0]) {
        document.querySelector('.${widgetName}.header').remove();
    }

    function ${widgetName}_toPage (pageNumber) {
        ${widgetName}_collectionsDiv.innerHTML = '';
        beganLoading('.${widgetName}.items');
        SnapCloud.${query}(
            $user,
            pageNumber,
            ${widgetName}_pageSize,
            ${extraParam} // used for search terms, collection names, etc
            function (response) {
                setTitle($title);

                ${widgetName}_totalPages = response.pages;
                if (${widgetName}_totalPages == 1) {
                    document.querySelector('.${widgetName}.paginator').remove();
                } else {
                    ${widgetName}_totalPagesSpan.textContent =
                        ${widgetName}_totalPages;
                }

                if (response.collections[0]) {
                    response.collections.forEach(function (collection) {
                        ${widgetName}_collectionsDiv.append(
                            newCollectionDiv(
                                collection, 
                                { 
                                    size: 'small', 
                                    gridSize: 5, 
                                    extraFields: {
                                        author: 'username',
                                        isPublic: 'shared',
                                        isPublished: 'published'
                                    }
                                }
                            )
                        );
                    });
                } else {
                    // Collection is empty. Let's remove the carousel altogether
                    document.querySelectorAll('.${widgetName}').forEach(
                        function (each) { each.remove(); }
                    );
                }
                doneLoading('.${widgetName}.items');
            },
            function (error) {
                genericError(error);
            }
        );
        ${widgetName}_page = pageNumber;
        ${widgetName}_pageSpan.textContent = pageNumber;
    };
</script>
