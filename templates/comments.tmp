<script src="js/discourse.js"></script>

<h2>Comments</h2>
<div class="comments"></div>

<script>
    var commentsDiv = document.querySelector('.comments');

    SnapCloud.request(
        'GET',
        '/projects/' +
            encodeURIComponent(pageUser()) + '/' +
            encodeURIComponent(pageProject()) +
        '/comments',
        function (response) {
            console.log(response.comments);
            response.comments.forEach(function (each) {
                var commentDiv = document.createElement('div');
                commentDiv.classList.add('comment');
                commentsDiv.appendChild(commentDiv);
                renderComment(each, commentDiv);
            });
        },
        genericError,
        'Could not read comments'
    );

    var renderComment = function (comment, commentDiv) {
        var dateSpan = document.createElement('span'),
            contentsDiv = document.createElement('div'),
            separatorSpan = document.createElement('span');

        dateSpan.classList.add('date');
        contentsDiv.classList.add('contents');
        separatorSpan.classList.add('separator');

        dateSpan.innerHTML = formatDate(comment.created_at);
        contentsDiv.innerText = comment.content;

        [/*userAnchor(comment.author), */contentsDiv, dateSpan, separatorSpan].forEach(
            function (element) { commentDiv.appendChild(element); }
        );
    };
</script>
